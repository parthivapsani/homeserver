# =============================================================================
# SAMBA CONFIGURATION
# =============================================================================
# This is an alternative to using environment variables in docker-compose
# For more control, mount this file to /etc/samba/smb.conf in the container
# =============================================================================

[global]
    workgroup = WORKGROUP
    server string = Home Server
    security = user
    map to guest = Bad User

    # Logging
    log file = /var/log/samba/log.%m
    max log size = 50

    # Performance
    socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072
    read raw = yes
    write raw = yes
    use sendfile = yes
    aio read size = 16384
    aio write size = 16384

    # macOS Compatibility (Time Machine)
    vfs objects = fruit streams_xattr
    fruit:metadata = stream
    fruit:model = MacSamba
    fruit:posix_rename = yes
    fruit:veto_appledouble = no
    fruit:nfs_aces = no
    fruit:wipe_intentionally_left_blank_rfork = yes
    fruit:delete_empty_adfiles = yes

# =============================================================================
# SHARES
# =============================================================================

[Media]
    comment = Media Library
    path = /media
    browseable = yes
    read only = no
    guest ok = no
    valid users = homeserver
    create mask = 0664
    directory mask = 0775

[Backups]
    comment = Backup Storage
    path = /backups
    browseable = yes
    read only = no
    guest ok = no
    valid users = homeserver
    create mask = 0664
    directory mask = 0775

[TimeMachine]
    comment = Time Machine Backups
    path = /timemachine
    browseable = yes
    read only = no
    guest ok = no
    valid users = homeserver
    create mask = 0664
    directory mask = 0775
    # Time Machine specific settings
    fruit:time machine = yes
    fruit:time machine max size = 500G
    # Spotlight indexing (optional)
    spotlight = no

[Footage]
    comment = Video Footage Backup
    path = /backups/footage
    browseable = yes
    read only = no
    guest ok = no
    valid users = homeserver
    create mask = 0664
    directory mask = 0775
